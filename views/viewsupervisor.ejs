<%- include("partials/header.ejs")%>

<div class="subjects-wrapper">
  <div class="subjects-container">
    <h1>Supervisors' List</h1>

    <div class="search-container">
        <input type="text" id="searchBar" placeholder="Search user..." oninput="filterCourses()">
        <div class="search-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </div>
      </div>
      

    <form action="/viewsupervisors" method="POST" onsubmit="return submitSelected(event)">
      <div class="course-list" id="courseList">
        <% for (var i = 0; i < sups.length; i++) { %>
          <div class="course-item" data-value="<%= sups[i].student_id %>" onclick="toggleSelect(this)">
            <%= sups[i].first_name + " " + sups[i].last_name%>
          </div>
        <% } %>
      </div>

      <input type="hidden" name="path" value="1">

      <%if(locals.error){%>
        <p style="color:red"><%= error%></p>
      <%}%>
      <%if(locals.message){%>
        <p style="color: #0a2e5c"><%= message%></p>
    <%}%>

      <div class="button-container">
        <input type="submit" name="SUB_BTN" id="submitBtn" value="Remove Supervisor" disabled class="styled-btn back-btn">
        <input type="submit" name="SUB_BTN" value="Add Supervisor" class="styled-btn back-btn">
      </div>    
    </form>
  </div>
</div>

<script>
    function submitSelected(event) {
        const submitBtn = event.submitter?.value;
        if (submitBtn === "Remove Supervisor") {
            const form = document.querySelector('form');
            document.querySelectorAll('input[name="selected_supervisor[]"]').forEach(el => el.remove());
            const selected = [...document.querySelectorAll('.course-item.selected')]
                .map(el => el.dataset.value);
            selected.forEach(val => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'selected_supervisor[]';
                input.value = val;
                form.appendChild(input);
            });

            return selected.length > 0;
        }
        return true;
    }
  
    function filterCourses() {
      const input = document.getElementById('searchBar').value.toLowerCase();
      const courses = document.querySelectorAll('.course-item');
      courses.forEach(course => {
        const text = course.textContent.toLowerCase();
        course.style.display = text.includes(input) ? 'block' : 'none';
      });
    }

    function toggleSelect(elem) {
      elem.classList.toggle('selected');
      const selected = [...document.querySelectorAll('.course-item.selected')]
                  .map(el => el.dataset.value);

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = selected.length === 0;
      submitBtn.classList.toggle('enabled', selected.length > 0);

      document.getElementById('selectedCount').textContent = `${selected.length} selected`;
    } 
</script>

  
<%- include("partials/footer.ejs") %>
