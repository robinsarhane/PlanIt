<%- include("partials/header.ejs")%>

<div class="subjects-wrapper">
  <div class="subjects-container">
    <h1>Select Your Subjects</h1>

    <div class="search-container">
        <input type="text" id="searchBar" placeholder="Search subjects..." oninput="filterCourses()">
        <div class="search-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </div>
      </div>
      

    <form action="/course" method="POST" onsubmit="return submitSelected()">
      <div class="course-list" id="courseList">
        <% for (var i = 0; i < subjects.length; i++) { %>
          <div class="course-item" data-value="<%= subjects[i].subject %>" onclick="toggleSelect(this)">
            <%= subjects[i].subject + " - " + subjects[i].subject_name %>
          </div>
        <% } %>
      </div>

      <input type="hidden" name="path" value="1">
      <div class="button-container">
        <input type="submit" name="SUB_BTN" id="submitBtn" value="Course Search" disabled>
        <span id="selectedCount" class="subject-count">0 selected</span>
      </div>    
    </form>
  </div>
</div>

<script>
    function submitSelected() {
      const form = document.querySelector('form');
      document.querySelectorAll('input[name="sel_subj[]"]').forEach(el => el.remove());
      const selected = [...document.querySelectorAll('.course-item.selected')]
          .map(el => el.dataset.value);
      selected.forEach(val => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'sel_subj[]';
        input.value = val;
        form.appendChild(input);
      });

      return selected.length > 0;
    }
  
    function filterCourses() {
      const input = document.getElementById('searchBar').value.toLowerCase();
      const courses = document.querySelectorAll('.course-item');
      courses.forEach(course => {
        const text = course.textContent.toLowerCase();
        course.style.display = text.includes(input) ? 'block' : 'none';
      });
    }

    function toggleSelect(elem) {
      elem.classList.toggle('selected');
      const selected = [...document.querySelectorAll('.course-item.selected')]
                  .map(el => el.dataset.value);

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = selected.length === 0;
      submitBtn.classList.toggle('enabled', selected.length > 0);

      document.getElementById('selectedCount').textContent = `${selected.length} selected`;
    } 
</script>

  
<%- include("partials/footer.ejs") %>
